---
title: 'Muestra de Brightcove Player: Descargar el complemento de audio'
description: 'En este tema, aprenderá cómo crear un enlace para permitir descargar la mejor calidad MP4 de un activo de audio que se reproduce en Brightcove Player. El código se escribirá y explicará, luego, en el documento, se convertirá en un complemento para facilitar su uso con diferentes reproductores.'
parent: Code Samples
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

  <aside class="bcls-aside bcls-aside--information">El contenido de este documento se aplica únicamente a Video Cloud. Además, dado que los dispositivos iOS no tienen un sistema de archivos accesible por el usuario, el complemento no funcionará en dispositivos iOS.</aside>
  <section class="bcls-section">
    <h2 id="Player_example">Ejemplo de jugador</h2>
    <!-- UPDATE description -->
    
    <aside class="bcls-aside bcls-aside--information">Este ejemplo y el código asociado se proporcionan como guía para el desarrollo de su producción. El código no está certificado para uso en producción ni se admite oficialmente.</aside>
    <p>Verá un Brightcove Player con estilo para reproducir activos de audio. Después de hacer clic en reproducir, verá en el lado derecho de la barra de control un icono de descarga. Al hacer clic en este icono, la reproducción del recurso de audio se descargará a través del navegador.</p>
    <p>Hay una muestra MUY similar que usa recursos de video en lugar de audio en el <a href="/code-samples/brightcove-player-sample-download-video-plugin.html">Muestra de jugador de Brightcove: Descargue el</a> documento del complemento de vídeo.</p>
    <!-- UPDATE codepen here -->
    
    <p class="codepen" data-height="413" data-theme-id="34967" data-default-tab="result" data-user="rcrooks1969" data-slug-hash="QodMJe" style="height: 413px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="Download Audio Plugin"><span>Ver la prisma <a href="https://codepen.io/team/rcrooks1969/pen/QodMJe/"> Descargar el complemento de audio</a> por Brightcove Learning Services (<a href="https://codepen.io/rcrooks1969"> rcrooks1969</a> ) en <a href="https://codepen.io">CodePen</a>.</span></p>
    <script async src="https://static.codepen.io/assets/embed/ei.js"></script><!-- UPDATE link to GitHub source -->
    
    <br/>
    <aside class="bcls-aside bcls-aside--tip">COMPORTAMIENTO DE DESCARGA DEL NAVEGADOR: Los navegadores han cambiado la forma en que manejan las descargas de archivos. Safari, Firefox y Chrome abren el vídeo descargado en una nueva ventana o pestaña, lo que generalmente no es un comportamiento deseado. Por este motivo, este ejemplo utiliza una herramienta JavaScript del lado del cliente para obligar a los navegadores a descargar correctamente el vídeo. Para obtener información detallada de la herramienta, consulte <a href="https://www.npmjs.com/package/downloadjs">https://www.npmjs.com/package/downloadjs</a>.</aside>
    
    <h3>Código fuente</h3>
          <p>Ver el <a href="https://github.com/BrightcoveLearning/18743-download-audio-plugin">solución completa en GitHub</a>.</p>
  </section>
  <section class="bcls-section">
    <details>
      <summary><h2 id="Using_the_CodePen">Uso de CodePen</h2></summary>
      <p>Estos son algunos consejos para utilizar eficazmente el CodePen anterior:</p>
      <ul>
        <li>Cambie la visualización real del reproductor haciendo clic en el <strong translate="No">Resultado</strong> botón.</li>
        <li>Haga clic en el <strong translate="No">HTML / CSS / JS</strong> botones para mostrar UNO de los tipos de código.</li>
        <li>Más adelante, en este documento, la lógica, el flujo y el estilo utilizados en la aplicación se analizarán en la configuración de <a href="#Player/HTML_configuration">reproductor/HTML</a>, Flujo de <a href="#Application_flow">aplicaciones</a> y Estilo de <a href="#Application_styling">la aplicación.</a> secciones. La mejor manera de seguir la información de estas secciones es:
          <ol>
            <li>Haga clic en el <strong translate="No">EDITAR CODEPEN</strong> en el CodePen y tenga el código disponible en un navegador / pestaña del navegador.</li>
            <li>En CodePen, ajusta el código que quieres que se muestre. Puede cambiar el ancho de las distintas secciones de código dentro de CodePen.</li>
            <li>Ver el <a href="#Player/HTML_configuration">Configuración de reproductor / HTML</a> , <a href="#Application_flow">Flujo de aplicación</a> y / o <a href="#Application_styling">Estilo de aplicación</a> secciones en otra pestaña del navegador / navegador. Ahora podrá seguir las explicaciones del código y, al mismo tiempo, ver el código.</li>
          </ol>
        </li>
      </ul>
    </details>
  </section>
  <section class="bcls-section">
    <details>
      <summary><h2 id="Development_sequence">secuencia de desarrollo</h2></summary> 
      <p>Esta es la secuencia de desarrollo recomendada:</p>
      <ol>
        <li>Utilice la implementación del reproductor de incrustación en la página para probar la funcionalidad de su reproductor, complemento y CSS (si es necesario CSS)</li>
        <li>Coloque el JavaScript y CSS del plugin en archivos separados para pruebas locales</li>
        <li>Implementa el código del plugin y CSS en tu servidor una vez que hayas resuelto cualquier error.</li>
        <li>Usa Studio para agregar el plugin y CSS a tu reproductor</li>
        <li>Reemplace la implementación del reproductor de incrustación en página si determina que la implementación de iframe se ajusta mejor (se detalla en la siguiente sección)</li>
      </ol>
      <p>Para obtener más información sobre estos pasos, consulte la sección <a href="/coding-topics/step-step-plugin-development.html">Paso a paso: </a> Guía de desarrollo de plugins.</p>
      <h3>iframe o incrustación en página</h3>
      <p>Al desarrollar mejoras para Brightcove Player, deberás decidir si el código se ajusta mejor a la implementación de iframe o incrustación en la página. La recomendación de práctica recomendada es crear un complemento para usarlo con una implementación de iframe. Las ventajas de utilizar el reproductor iframe son:</p>
      <ul>
        <li>Sin colisiones con JavaScript y/o CSS existentes</li>
        <li>Responde automáticamente</li>
        <li>El iframe facilita el uso en aplicaciones de redes sociales (o siempre que el vídeo tenga que «viajar» a otras aplicaciones)</li>
      </ul>
      <p>Aunque la integración del reproductor de incrustación en la página puede ser más compleja, hay ocasiones en que planificará el código en torno a esa implementación. Para generalizar, este enfoque es mejor cuando la página que contiene necesita comunicarse con el reproductor. En concreto, estos son algunos ejemplos:</p>
      <ul>
        <li>El código de la página que contiene necesita escuchar y actuar en función de los eventos de los jugadores</li>
        <li>El reproductor utiliza estilos de la página que lo contiene</li>
        <li>El iframe hará que la lógica de la aplicación falle, como un redireccionamiento desde la página que contiene</li>
      </ul>
      <p>Incluso si tu implementación final no utiliza el código iframe, puedes seguir usando el código de incrustación en la página con un plugin para tu JavaScript y un archivo separado para tu CSS. Esto encapsula tu lógica para que puedas utilizarla fácilmente en varios reproductores.</p>
    </details>
  </section>
  <section class="bcls-section">
    <h2 id="API/Plugin_resources_used">Recursos de API/plugins utilizados</h2>
    <!-- UPDATE table, remove unneeded columns -->
    
    <table class="bcls-table">
      <thead class="bcls-table__head">
        <tr>
          <th>Métodos API</th>
          <th>Eventos API</th>
          <th>Propiedades de API</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td><a href="https://docs.brightcove.com/brightcove-player/current-release/module-events.html#.on"><code translate="No">on()</code></a></td>
          <td><a href="https://docs.brightcove.com/brightcove-player/current-release/Player.html#event:loadstart"><code translate="No">loadstart</code></a></td>
          <td><a href="/references/video-metadata-mediainfo.html"><code translate="No">player.mediainfo</code></a></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td><a href="https://docs.brightcove.com/brightcove-player/current-release/CustomControlSpacer.html"><code translate="No">player.controlBar.customControlSpacer</code></a></td>
        </tr>
      </tbody>
    </table>
    <!-- <aside class="bcls-aside bcls-aside--tip">This code sample uses one of the Brightcove REST APIs. To understand working with this API it is vital you read and understand the <a href="/getting-started/learning-guide-using-rest-apis.html">Learning Guide: Using the REST APIs</a> document.</aside> --></section>
  <!-- UPDATE player and HTML configuration -->
  
  <section class="bcls-section">
    <h2 id="Player/HTML_configuration">Configuración de reproductor/HTML</h2>
    <p>En esta sección se detalla cualquier configuración especial necesaria durante la creación del reproductor. Además, se describen otros elementos HTML que deben agregarse a la página, más allá del código de implementación del reproductor de incrustación de la página.</p>
    <h3>Configuración del reproductor</h3>
    <p>No se requiere ninguna configuración especial para el reproductor de Brightcove que crea para este ejemplo.</p>
    <h3>Otros HTML</h3>
    <p>No se añaden otros elementos HTML a la página.</p>
  </section>
  <!-- UPDATE application flow -->
  
  <section class="bcls-section">
    <h2 id="Application_flow">Flujo de aplicaciones</h2>
    <p>La lógica básica detrás de esta aplicación es:</p>
    <ul>
      <li>Obtenga el nombre del activo de audio y extraiga las representaciones MP4 de la matriz de fuentes.</li>
      <li>Recorra todas las versiones y extraiga las versiones MP4.</li>
      <li>Ordene la matriz MP4 del <code translate="No">size</code> atributo, de mayor a menor.</li>
      <li>Asignar la interpretación más grande a una variable.</li>
      <li>Cree una imagen en la que se pueda hacer clic que descargue la interpretación dentro de un HTML <code translate="No">div</code> elemento.</li>
      <li>Coloque el elemento de imagen del recurso de descarga en el DOM.</li>
    </ul>
    <!-- UPDATE task 1 -->
    
    <h3>Obtenga el nombre del activo de audio y extraiga las representaciones MP4 de la matriz de fuentes</h3>
    <p>Busque el código etiquetado:</p>
    <pre>
<code class="language-javascript" translate="No">// ### Get video name and the MP4 renditions ###</code></pre>
    <p>En primer lugar, a la <code translate="No">videoName</code> variable se le asigna el nombre del vídeo&nbsp;(con espacios eliminados) para utilizarlo en la etiqueta de anclaje HTML construida dinámicamente más adelante en el código. A continuación, se asignan a la <code translate="No">renditionsAra</code> variable todas las copias posibles para el vídeo.</p>
    <p>Por supuesto, para que este complemento funcione correctamente, debe tener al menos una reproducción MP4 en las fuentes.</p>
    <!-- UPDATE task 2 -->
    
    <h3>Repasa todas las copias de vídeo y extrae las versiones MP4</h3>
    <p>Busque el código etiquetado:</p>
    <pre>
<code class="language-javascript" translate="No">// ### Loop over videos and extract only MP4 versions ###</code></pre>
    <p>Bucle sobre la matriz y asigne a las copias <code translate="No">mp4Ara</code> variables donde <code translate="No">container</code> es <strong>MP4</strong>, AND la copia tiene una <code translate="No">src</code> propiedad. Las copias MP4 aparecen dos veces en la <code translate="No">sources</code> matriz, una con una <code translate="No">src</code> propiedad y otra con un <code translate="No">stream_name</code> propiedad. El primero es para descarga progresiva y el segundo para streaming.</p>
    <p>Las capturas de pantalla siguientes muestran la consola que muestra todas las copias y, a continuación, las copias filtradas que se muestran en las copias MP4.</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="All renditions" src="/assets/images/code-samples/brightcove-player-sample-download-audio-plugin/console-all-renditions.png" />
      <figcaption class="bcls-caption--image">Todas las copias</figcaption>
    </figure>
    <figure class="bcls-figure"><img class="bcls-image" alt="Only MP4 renditions after filtering" src="/assets/images/code-samples/brightcove-player-sample-download-audio-plugin/console-mp4-renditions-only.png" />
      <figcaption class="bcls-caption--image">Solo copias MP4 después del filtrado</figcaption>
    </figure>
    <!-- UPDATE task 3 -->
    
    <h3>Ordena la matriz MP4 en el <code translate="No">size</code> atributo, de mayor a menor</h3>
    <p>Busque el código etiquetado:</p>
    <pre>
<code class="language-javascript" translate="No">// ### Sort the renditions from highest to lowest on size ###</code></pre>
    <p>Ordenar el <code translate="No">mp4Ara</code> <code translate="No">sort()</code> método de JavaScript</p>
    <!-- UPDATE task 3 -->
    
    <h3>Asignar el vídeo más grande a una variable</h3>
    <p>Busque el código etiquetado:</p>
    <pre>
<code class="language-javascript" translate="No">// ### Extract the highest rendition ###</code></pre>
    <p>Asigne a la <code translate="No">highestQuality</code> variable el valor de índice cero de la matriz de copias MP4 ordenadas.</p>
    <!-- UPDATE task 3 -->
    
    <h3>Crear un elemento que contenga una imagen en la que se puede hacer clic dentro de un <code translate="No">div</code> elemento HTML</h3>
    <p>Busque el código etiquetado:</p>
    <pre>
<code class="language-javascript" translate="No">// ### Build the download image element ###</code></pre>
    <p>En la parte superior del código JavaScript, el HTML <code translate="No">div</code> y <code translate="No">img</code> los elementos se crean y almacenan en variables. Estos elementos se manipulan para crear dinámicamente un elemento HTML que funciona como botón de descarga. A continuación se muestra un ejemplo de cómo podría aparecer el elemento creado dinámicamente:</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="dynamically built download element" src="/assets/images/code-samples/brightcove-player-sample-download-audio-plugin/download-element.png" /></figure>
    <!-- UPDATE task 3 -->
    
    <h3>Coloque el elemento del botón de descarga en el DOM</h3>
    <p>Busque el código etiquetado:</p>
    <pre>
<code class="language-javascript" translate="No">// ### Place the download button ###</code></pre>
    <p>En este caso, el botón de descarga se coloca en el espaciador de la barra de control. En primer lugar, se obtiene una referencia al elemento espaciador, luego se define un conjunto de atributos para colocar el nuevo elemento en el espaciador y, por último, el nuevo elemento colocado en el espaciador.</p>
  </section>
  <!-- UPDATE CSS description -->
  
  <section class="bcls-section">
    <h2 id="Application_styling">Estilismo de aplicaciones</h2>
    <p>El CSS hace dos trabajos, ellos son:</p>
    <ul>
      <li>Diseña el reproductor para que tenga un aspecto de "solo audio".</li>
      <li>Dimensiona y posiciona el botón de descarga para colocarlo en la barra de control.</li>
    </ul>
  </section>
  <section class="bcls-section">
    <h2 id="Plugin_code">Código de plugin</h2>
    <p>Normalmente, al convertir JavaScript en un complemento de Brightcove Player, se necesitan cambios nominales. Un cambio necesario es reemplazar el uso estándar del <code translate="No">ready()</code> método por el código que define un complemento.</p>
    <p>Aquí está el código de inicio a JavaScript muy utilizado que funcionará con el reproductor:</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.getPlayer('myPlayerID').ready(function() {
  var myPlayer = this;
  ...
});</code></pre>
    <p>Cambiarás la primera línea para usar la sintaxis estándar para iniciar un plugin de Brightcove Player:</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.registerPlugin('pluginName', function(options) {
  var myPlayer = this;
  ...
});</code></pre>
    <!-- UPDATE path to plugin's JavaScript -->
    
    <aside class="bcls-aside bcls-aside--tip">Dado que el complemento no funciona con iOS, es posible que desee agregar este código al complemento para evitar que el complemento intente descargarlo en iOS:
      <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.registerPlugin('downloadVideo', function() {
  if (videojs.browser.IS_IOS) {
    return;
  }

  // rest of the plugin...
});</code></pre>
    </aside>
    <p>Como se mencionó anteriormente, puede ver el código JavaScript del complemento en el repositorio de GitHub correspondiente de este documento: <a href="https://github.com/BrightcoveLearning/18743-download-audio-plugin/blob/master/plugin/download-audio.js">descargar-audio.js</a>.</p>
    <h3>Uso del complemento con un reproductor</h3>
    <p>Una vez que tengas los archivos CSS y JavaScript del plugin almacenados en una ubicación accesible a Internet, puedes usar el plugin con un reproductor. En Studio's <strong>JUGADORES</strong> módulo puedes elegir un jugador, luego en el <strong>PLUGINS</strong> sección agregue las URL a los archivos CSS y JavaScript, y también agregue el <strong>Nombre</strong> y <strong>Opciones</strong> , si se necesitan opciones.</p>
    <aside class="bcls-aside bcls-aside--tip">Para obtener más información sobre el uso de Studio para asignar complementos a los reproductores, consulte la <a href="https://studio.support.brightcove.com/players/configuring-player-plugins.html">Configuración de complementos del reproductor</a> documento.</aside>
  </section>
  <section class="bcls-section">
    <h2 id="Version_5_backwards_compatibility">Compatibilidad con versiones anteriores de la versión 5</h2>
    <p>Si desea que el plugin funcione con las versiones 5 y 6, se deben realizar algunos cambios en JavaScript. Se mostrarán los cambios y, a continuación, se mostrará un esqueleto del JavaScript.</p>
    <ol>
      <li>Añada la siguiente declaración de variables en la parte superior del archivo JavaScript. La variable define cómo registrar un complemento tanto para la versión 5 como para la versión 6:
        <pre class="line-numbers">
<code class="language-javascript" translate="No">var registerPlugin = videojs.registerPlugin || videojs.plugin;</code></pre>
      </li>
      <li>Cambia la primera línea anterior de JavaScript desde:
        <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.getPlayer('myPlayerID').ready(function() {</code></pre>
        a
        <pre class="line-numbers">
<code class="language-javascript" translate="No">registerPlugin("downloadAudio", function() {</code></pre>
      </li>
      <li>Cree una función debajo de todo el código existente que llame al complemento ahora definido:
        <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.getPlayer('myPlayerID').ready(function() {
  var player = this;
  player.downloadAudio();
});</code></pre>
      </li>
      <li>Compruebe que la estructura del código aparece de la siguiente manera:
        <pre class="line-numbers">
<code class="language-javascript" translate="No">var registerPlugin = videojs.registerPlugin || videojs.plugin;

registerPlugin("downloadAudio", function() {
  // Create variables and new div, anchor and image for download icon
  var myPlayer = this,
    videoName,
    totalRenditions,
    mp4Ara = [],
    highestQuality,
    spacer,
    newElement = document.createElement("div"),
    newImage = document.createElement("img");

    // REST OF JavaScript
    ...
});

videojs.getPlayer('myPlayerID').ready(function() {
  var player = this;
  player.downloadAudio();
});</code></pre>
      </li>
    </ol>
  </section>
</article>