---
title: Implementar puntos de referencia mediante programación
parent: General Information
description: In this topic, you will gain an understanding of cue points with Brightcove Player. You will then see how to programmatically create cue points and handle when a cue point is dispatched.
---

<article class="bcls-article">
  <h1>Implementar puntos de referencia mediante programación</h1>
  <summary>{{ page.description }}</summary>
  <style type="text/css">
.video-js { width: 640px; height: 360px; }
</style>
  <section class="bcls-section">
    <h2 id="Overview">Resumen</h2>
    <p>Se pueden establecer puntos de referencia para un video. Durante la reproducción de video, se envía un evento cuando se alcanza cada punto de referencia.</p>
    <div class="video-cloud-only">
      <p>Reproduzca el siguiente video para ver cómo el jugador muestra la información del punto de referencia en los tiempos de pre-roll, mid-roll (5 segundos, 10 segundos, 12 segundos) y post-roll.</p>
      <video-js id="myPlayerID" data-video-id="4740963811001" data-account="1752604059001" data-player="VkIrj2aFx" data-embed="default" class="video-js" controls="">&nbsp;</video-js>
      <p>******** Información del punto de referencia ********</p>
      <p id="insertionPoint">&nbsp;</p>
      <p>****** Información del punto de referencia final ******</p>
      <aside class="bcls-aside bcls-aside--information">Nota: los <strong>identificación</strong> las variables no tienen valores asociados ya que no se asignaron en Video Cloud.</aside>
    </div>
    <div class="player-only">
      <p>Reproduzca este video y verá información de cuatro puntos de referencia debajo del reproductor.</p>
      <video-js id="myPlayerID3" data-account="3676484087001" data-player="4f14e962-a11f-441f-8c00-0c89b8edb0a6" data-embed="default" class="video-js" controls="">&nbsp;</video-js>
      <p id="insertionPoint3">&nbsp;</p>
    </div>
  </section>
  <section class="bcls-section">
    <h2 id="Key_concepts">Conceptos clave</h2>
    <p><span class="video-cloud-only">Se deben comprender algunos conceptos para utilizar eficazmente los puntos de referencia en Brightcove Player. Estos conceptos se explican en esta sección del documento.</span><span class="player-only">Debe entenderse el siguiente concepto para utilizar eficazmente los puntos de referencia en Brightcove Player.</span></p>
    <div class="video-cloud-only">
      <h3>Puntos de referencia del catálogo de Video Cloud</h3>
      <p>El primer concepto a comprender tiene que ver con la terminología. En Brightcove Player, los puntos de referencia se almacenan como elementos de pista de texto, según el estándar HTML. Esto significa que cuando se utiliza un video de Video Cloud, cualquier punto de referencia de "estilo de Video Cloud" se convierte en pistas de texto.</p>
      <p>Estos puntos de referencia de "estilo de Video Cloud" también se pueden denominar puntos de referencia de "catálogo", ya que se leen del catálogo de Video Cloud (consulte la <a href="/references/player-catalog.html">Catálogo de jugadores</a> documento para más información sobre el catálogo). Cuando se lleva a cabo esta conversión, parte de la información del punto de referencia del catálogo, como el tipo y el tiempo del punto de referencia, se convierte en la pista de texto.</p>
      <h3>Estructura del punto de referencia del catálogo</h3>
      <p>El siguiente concepto que hay que entender es que existe una diferencia significativa entre los puntos de referencia del catálogo y la estructura del estándar HTML. La diferencia es que un punto de referencia HTML puede tener una duración. Esto significa que para cada punto de referencia, se distribuirán dos eventos de cambio de punto de referencia: uno al inicio del punto de referencia y otro al final del punto de referencia.</p>
      <p>En el proceso de conversión, cada punto de referencia del catálogo se convierte en un punto de referencia con tiempos de inicio y finalización idénticos. Esto significa que por cada punto de referencia del catálogo, se enviarán dos eventos de punto de referencia y se tendrán en cuenta en el código.</p>
    </div>
    <h3><code translate="No">activecues</code> formación</h3>
    <p><span class="video-cloud-only">Otro</span><span class="player-only">Un</span> Un punto conceptual importante que hay que entender cuando se trata de puntos de referencia HTML es el <code translate="No">activeCues</code> formación. Todos los puntos de referencia están definidos en una matriz. Hay otra matriz, <code translate="No">activeCues</code> , que contiene los puntos de referencia que están "activos", lo que significa que el tiempo de reproducción se encuentra entre las horas de inicio y finalización del punto de referencia.</p>
    <p>Cuando se utilizan puntos de referencia de catálogo, los tiempos de inicio y finalización son idénticos, por lo que estarán activos solo durante el segundo definido. Además, con los puntos de referencia del catálogo, es muy poco probable que dos puntos de referencia estén activos al mismo tiempo, ya que no se superpondrán.</p>
    <aside class="bcls-aside bcls-aside--information">Nota: Puede haber varios conjuntos de pistas de texto, por ejemplo, un conjunto para puntos de referencia y otro para subtítulos de vídeo. En el código de ejemplo de este documento, las pistas de texto de los puntos de referencia se encuentran tanto en el primer como en el segundo elemento de la matriz TextTracks. Verá esto reflejado en el código.</aside>
    <h3>Tipos de puntos de referencia</h3>
    <p>En este documento, verá puntos de referencia con un <code translate="No">type</code> propiedad asignada un valor. Estos valores de tipo se asignan al crear puntos de referencia en la interfaz de usuario de Studio. Hay dos tipos de puntos de referencia, pero ambos simplemente proporcionan un valor de cadena al <code translate="No">type</code> propiedad. El valor apropiado es útil solo si se usa en JavaScript personalizado mientras se procesa la información del punto de referencia. Los tipos se detallan aquí:</p>
    <ul>
      <li><strong>Anuncio</strong> - Asigna el valor de cadena de <code translate="No">AD</code> hacia <code translate="No">type</code> propiedad</li>
      <li><strong>Código</strong> - Asigna el valor de cadena de <code translate="No">CODE</code> hacia <code translate="No">type</code> propiedad</li>
    </ul>
  </section>
  <section class="bcls-section video-cloud-only">
    <h2 id="Video_Cloud_cue_points">Puntos de referencia de Video Cloud</h2>
    <p>En esta sección del documento, aprenderá a establecer puntos de referencia de catálogo y a escuchar los envíos de eventos de puntos de referencia de catálogo.</p>
    <h3>Configuración de puntos de referencia de Video Cloud</h3>
    <p>Los puntos de referencia de Video Cloud se pueden asociar a un vídeo mediante Video Cloud Studio y de otras formas, que se detallan en este documento: <a href="https://studio.support.brightcove.com/media/working-cue-points-media-module.html">Trabajar con puntos de referencia en el módulo de medios</a>.</p>
    <h3>Actuar sobre los puntos de referencia de Video Cloud: vídeo vinculado estáticamente al reproductor</h3>
    <p>En esta sección del documento, aprenderá a procesar los puntos de referencia del catálogo cuando el video se ha vinculado estáticamente al reproductor, lo que significa que el video se ha cargado en el reproductor en Studio o usando la API de administración del reproductor directamente.</p>
    <p>Para evitar una condición de carrera al intentar procesar puntos de referencia antes de que se carguen, debe utilizar el <code translate="No">loadedmetadata</code> evento que se enviará antes de tratar con los puntos de referencia. Una vez que se haya leído la pista de texto adecuada, utilice el <code translate="No">oncuechange</code> evento para escuchar los eventos de puntos de referencia que se enviarán.</p>
    <p>El siguiente código muestra la escucha de puntos de referencia y la visualización de los datos del punto de referencia. Tenga en cuenta que en este ejemplo, el video está vinculado estáticamente al reproductor.</p>
    <ul>
      <li>Línea 24: Cree un elemento de párrafo como ubicación en la que inyectar HTML creado dinámicamente.</li>
      <li>Líneas 31,43: Utilizar el <code translate="No">one()</code> método para agregar un detector de eventos para el <code translate="No">loadedmetadata</code> evento solo una vez. La función de controlador de eventos se define aquí de forma anónima.</li>
      <li>Línea 32: Recupere la matriz TextTracks utilizando el <code translate="No">textTracks()</code> método y, a continuación, asigne el elemento cero, que contiene los puntos de referencia, a la variable <code translate="No">tt</code>. Tenga en cuenta que en algunas implementaciones es posible que los puntos de referencia estén en un elemento de matriz diferente. Ver el <a href="#findtrack">Encuentra la pista correcta</a> sección a continuación para obtener más información.</li>
      <li>Líneas 33,41: Establece la función de controlador de eventos para cuando se distribuye el <code translate="No">oncuechange</code>evento.</li>
      <li>Línea 34: Compruebe para asegurarse de que está obteniendo el primer envío del punto de referencia (elemento de matriz cero). Sin esta condición, vería que se actuaría dos veces sobre cada punto de referencia. Tenga en cuenta que si utiliza puntos de referencia que tienen duraciones que se superponen, esta condición tendría que ser diferente.</li>
      <li>Líneas 35-39: Cree HTML de forma dinámica utilizando información del punto de referencia e injételas en la página HTML.</li>
      <li>Línea 42: Reproduce el vídeo.</li>
    </ul>
    <pre class="line-numbers" data-start="17">
<code class="language-html" translate="No">&lt;video-js id="myPlayerID"
data-account="1507807800001"
data-player="6aac508a-741e-41a2-bc7a-5805644cf089"
data-embed="default"
data-video-id="1507781667001"
class="video-js" controls&gt;&lt;/video-js&gt;

&lt;p id="insertionPoint"&gt;&lt;/p&gt;
&lt;script src="https://players.brightcove.net/1507807800001/6aac508a-741e-41a2-bc7a-5805644cf089_default/index.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
  videojs.getPlayer('myPlayerID').ready(function() {
    var player = this;
    player.one("loadedmetadata", function () {
      var tt = player.textTracks()[0];
      tt.oncuechange = function () {
        if (tt.activeCues[0] !== undefined) {
          var dynamicHTML = "id: " + tt.activeCues[0].id + ", ";
          dynamicHTML += "text: " + tt.activeCues[0].text + ", ";
          dynamicHTML += "startTime: " + tt.activeCues[0].startTime + ",  ";
          dynamicHTML += "endTime: " + tt.activeCues[0].endTime;
          document.getElementById("insertionPoint").innerHTML += dynamicHTML + "&lt;br/&gt;";
        }
      }
      player.play();
    });
  });
&lt;/script&gt;</code></pre>
    <h3>Actuar sobre los puntos de referencia de Video Cloud: cargar vídeo de forma dinámica en el reproductor</h3>
    <p>En esta sección del documento, aprenderá a procesar puntos de referencia del catálogo cuando el video se carga dinámicamente en el reproductor usando el <code translate="No">catalog.getVideo()</code> y <code translate="No">catalog.load()</code> métodos.</p>
    <p>Cuando usa el catálogo del reproductor para obtener y cargar el video, procesar los puntos de referencia es un poco más fácil que cuando usa un video enlazado estáticamente, ya que no necesita usar el <code translate="No">loadedmetadata</code> evento.</p>
    <ul>
      <li>Línea 76: Cree un elemento de párrafo como ubicación en la que inyectar HTML creado dinámicamente.</li>
      <li>Líneas 83,97: Utilizar el <code translate="No">catalog.getVideo()</code> método para recuperar un video. La función de devolución de llamada se define aquí de forma anónima.</li>
      <li>Línea 85: Utilizar el <code translate="No">catalog.load()</code> método para cargar el video en el reproductor.</li>
      <li>Línea 86: Recupere la matriz TextTracks utilizando el <code translate="No">textTracks()</code> método y, a continuación, asigne el elemento cero, que contiene los puntos de referencia, a la variable <code translate="No">tt</code>. Tenga en cuenta que en algunas implementaciones es posible que los puntos de referencia estén en un elemento de matriz diferente. Ver el <a href="#findtrack">Encuentra la pista correcta</a> sección a continuación para obtener más información.</li>
      <li>Líneas 87,95: Establece la función de controlador de eventos para cuando se distribuye el <code translate="No">oncuechange</code>evento.</li>
      <li>Línea 88: Asegúrese de que el primer punto de referencia (elemento de matriz cero) esté definido. Sin esta condición, vería que cada punto de referencia se actuaría dos veces, la segunda vez sin elementos definidos en el <code translate="No">activecues</code> array (ya que el segundo cambio de cue es para el final del punto de cue). Tenga en cuenta que si utiliza puntos de referencia que tienen duraciones que se superponen, esta condición tendría que ser diferente.</li>
      <li>Líneas 89-93: Cree HTML de forma dinámica utilizando información del punto de referencia e injételas en la página HTML.</li>
      <li>Línea 96: Reproduce el vídeo.</li>
    </ul>
    <pre class="line-numbers" data-start="69">
<code class="language-html" translate="No">&lt;video-js id="myPlayerID"
  data-account="1507807800001"
  data-player="3c59134e-89e8-4864-87e2-3cc871f8c361"
  data-embed="default"
  data-video-id=""
  class="video-js" controls&gt;&lt;/video-js&gt;

  &lt;p id="insertionPoint"&gt;&lt;/p&gt;

  &lt;script src="https://players.brightcove.net/1507807800001/3c59134e-89e8-4864-87e2-3cc871f8c361_default/index.min.js"&gt;&lt;/script&gt;

  &lt;script&gt;
  videojs.getPlayer('myPlayerID').ready(function() {
    var player = this;
    player.catalog.getVideo('1507781667001', function (error, video) {
      //deal with error
      player.catalog.load(video);
      player.one("loadedmetadata", function () {
        var tt = player.textTracks()[0];
        tt.oncuechange = function () {
          if (tt.activeCues[0] !== undefined) {
            var dynamicHTML = "id: " + tt.activeCues[0].id + ", ";
            dynamicHTML += "text: " + tt.activeCues[0].text + ", ";
            dynamicHTML += "startTime: " + tt.activeCues[0].startTime + ",  ";
            dynamicHTML += "endTime: " + tt.activeCues[0].endTime;
            document.getElementById("insertionPoint").innerHTML += dynamicHTML + "&lt;br/&gt;";
          }
        }
      });
      player.play();
    });
  });
&lt;/script&gt;</code></pre>
    <h3 id="allvcinfo">Recuperar toda la información de los puntos de referencia de Video Cloud</h3>
    <p>Como habrá notado, no toda la información de los puntos de referencia de Video Cloud está disponible directamente en el <code translate="No">activecues</code> formación. Esto se remedia fácilmente recuperando la información deseada del <code translate="No">mediainfo</code> propiedad.</p>
    <p>El enfoque básico de esta solución es:</p>
    <ol>
      <li>Esperen al <code translate="No">loadstart</code> evento para el <code translate="No">mediainfo</code> propiedad para ser poblada.</li>
      <li>Asignar el <code translate="No">cue_points</code> matriz de la <code translate="No">mediainfo</code> propiedad a una variable. Esta variable contiene información completa sobre los puntos de referencia de Video Cloud.</li>
      <li>En un evento de punto de referencia, recupere los datos del punto de referencia correspondiente según el <code translate="No">time</code> valor de la propiedad. Esto se hará usando una función auxiliar que toma un objeto de una matriz en función de un valor de propiedad en el objeto.</li>
      <li>Utilice los datos del punto de referencia.</li>
    </ol>
    <p>La siguiente imagen muestra la matriz de puntos de referencia completa (arriba a la izquierda), la colección de datos de un solo punto de referencia (arriba a la derecha) y una propiedad de esa colección de datos de puntos de referencia únicos (abajo a la derecha).</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="cue point data" src="/assets/images/general/cue-point-all-vc-data.png" /></figure>
    <p>En el fragmento a continuación, solo se explicará el código nuevo / modificado de los ejemplos anteriores.</p>
    <ul>
      <li>Líneas 452-463: Incluya la función que se utilizará para extraer una colección de datos de un solo punto de referencia de la matriz de todos los puntos de referencia. Tenga en cuenta que le pasa la matriz de todos los puntos de referencia, la propiedad en la que está buscando un valor específico y, por último, el valor que está buscando.</li>
      <li>Línea 432: Escucha el <code translate="No">loadstart</code> evento. Cuando su video comience a cargar, entonces el <code translate="No">mediainfo</code> la propiedad está poblada.</li>
      <li>Línea 434: Asigne la matriz de todos los puntos de referencia de Video Cloud a una variable.</li>
      <li>Línea 443: En el controlador de eventos de despacho del punto de referencia, asigne la recopilación de datos del punto de referencia específico a una variable. Aquí es donde se llama a la función mencionada en el primer punto. Los argumentos utilizados son:
        <ul>
          <li><code translate="No">cuePointAra</code>: Toda la colección de puntos de referencia de Video Cloud.</li>
          <li><code translate="No">'time'</code>: La propiedad en la que buscar un valor.</li>
          <li><code translate="No">tt.activeCues[0].startTime</code>: La hora de inicio del punto de referencia que se maneja actualmente en el controlador de eventos de despacho de puntos de referencia.</li>
        </ul>
      </li>
      <li>Líneas 444-445: Depuración <code translate="No">console.log()</code> llamadas a métodos, que deben eliminarse en el código de producción.</li>
    </ul>
    <pre class="line-numbers" data-start="426">
<code class="language-html" translate="No">&lt;script&gt;
  videojs.getPlayer('myPlayerID').ready(function() {
    var myPlayer = this,
      cuePointAra = [],
      allCuePointData;
    myPlayer.on('loadstart', function () {
      //console.log('mediainfo', myPlayer.mediainfo);
      cuePointAra = myPlayer.mediainfo.cue_points;
      var tt = myPlayer.textTracks()[0];
      tt.oncuechange = function () {
        if (tt.activeCues[0] !== undefined) {
          var dynamicHTML = "id: " + tt.activeCues[0].id + ", ";
          dynamicHTML += "text: " + tt.activeCues[0].text + ", ";
          dynamicHTML += "startTime: " + tt.activeCues[0].startTime + ",  ";
          dynamicHTML += "endTime: " + tt.activeCues[0].endTime;
          document.getElementById("insertionPoint").innerHTML += dynamicHTML + "&lt;br/&gt;";
          allCuePointData = getSubArray(cuePointAra, 'time', tt.activeCues[0].startTime);
          console.log('cue point data:', allCuePointData);
          console.log('cue point metadata:', allCuePointData[0].metadata);
        }
      }
      myPlayer.play();
      myPlayer.muted(true);
    });

    function getSubArray(targetArray, objProperty, value) {
      var i, totalItems = targetArray.length,
        objFound = false,
        idxArr = [];
      for (i = 0; i &lt; totalItems; i++) {
        if (targetArray[i][objProperty] === value) {
          objFound = true;
          idxArr.push(targetArray[i]);
        }
      }
      return idxArr;
    };
  });
&lt;/script&gt;</code></pre>
  </section>
  <section class="bcls-section">
    <h2 id="HTML5_standard_cue_points">Puntos de referencia estándar HTML5</h2>
    <p>Los puntos de referencia estándar HTML5 se almacenan como elementos de pista en un formato prescrito. Se puede encontrar un buen contenido introductorio en el siguiente tutorial de HTML5 Rocks: <a href="//www.html5rocks.com/en/tutorials/track/basics/">Introducción al elemento Track</a>. En esta sección del documento, aprenderá el formato de los archivos de puntos de referencia de WebVTT y luego cómo procesar esos puntos de referencia.</p>
    <h3>Formato de archivo WebVTT para puntos de referencia</h3>
    <p>El formato de archivo WebVTT está estrictamente definido. Para los puntos de referencia, el archivo se compone de la siguiente manera:</p>
    <ul>
      <li>La cuerda <strong>WebVTT</strong> como la primera línea del archivo</li>
      <li>Una sola línea en blanco</li>
      <li>El identificador de un punto de referencia específico</li>
      <li>La duración en el formulario <strong>00: 00: 00.000 -&gt; 00: 00: 00.000</strong> ; este es el formato horas: minutos: segundos milisegundos y se analiza estrictamente; los números deben rellenarse con ceros si es necesario</li>
      <li>Los caracteres que siguen la duración a la siguiente línea en blanco se colocan en un <strong>texto</strong> valor; si desea almacenar varios valores dispares, JSON funciona bien, ya que se puede analizar fácilmente</li>
      <li>Una sola línea en blanco</li>
      <li>Se pueden agregar múltiples puntos de referencia usando el formato de identificador / duración / texto / línea en blanco</li>
    </ul>
    <aside class="bcls-aside bcls-aside--tip">Nota: Puede validar su formato WebVTT con este <a href="//quuz.org/webvtt/">validador</a>.</aside>
    <p>El siguiente es un documento válido de puntos de referencia de WebVTT que define dos puntos de referencia, uno con una duración de 2 a 5 segundos y otro con una duración de 10 a 15 segundos:</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">WEBVTT

multiCell
00:00:02.000 --&gt; 00:00:05.000
{
"title": "Multi-celled organisms",
"description": "Multi-celled organisms have different types of cells that perform specialized functions.",
"src": "multiCell.jpg",
"href": "http://en.wikipedia.org/wiki/Multicellular"
}

insects
00:00:10.000 --&gt; 00:00:15.000
{
"title": "Insects",
"description": "Insects are the most diverse group of animals on the planet with estimates for the total number of current species range from two million to 50 million. The first insects appeared around 400 million years ago, identifiable by a hard exoskeleton, three-part body, six legs, compound eyes and antennae.",
"src": "insects.jpg",
"href": "http://en.wikipedia.org/wiki/Insects"
}</code></pre>
    <p>Cuando reproduzca el siguiente video, verá procesado el archivo WebVTT del punto de referencia que se muestra arriba. Al comienzo de un punto de referencia, verá HTML creado dinámicamente inyectado en la página, seguido de un JSON analizado del <strong>texto</strong> campo. Al final del punto de referencia, el mensaje <strong>Duración del punto de referencia sobre</strong> se visualiza.</p>
    <video-js id="myPlayerID2" data-video-id="4607357817001" data-account="1752604059001" data-player="VkIrj2aFx" data-embed="default" class="video-js" controls="">
      <track kind="metadata" src="https://solutions.brightcove.com/bcls/tests/player/cuepoints.vtt" />
    </video-js>
    <p>******** Información del punto de referencia ********</p>
    <p id="insertionPoint2">&nbsp;</p>
    <p>****** Información del punto de referencia final ******</p>
    <h3>Descripción general de los puntos de referencia del proceso</h3>
    <p>Los pasos básicos para utilizar puntos de referencia estándar HTML5 son:</p>
    <ol>
      <li>Leer en el archivo WebVTT que contiene los puntos de referencia usando un <code translate="No">&lt;track&gt;</code> etiqueta anidada como hijo de la <code translate="No">&lt;video-js&gt;</code> etiqueta.</li>
      <li>en un <code translate="No">loadedmetadata</code> controlador de eventos, recupere el elemento de pista de texto adecuado.</li>
      <li>En el mismo controlador de eventos, configure un segundo controlador de eventos para el <code translate="No">oncuechange</code> evento de punto de referencia.</li>
      <li>En el <code translate="No">oncuechange</code> controlador de eventos, compruebe si el <code translate="No">activecues</code> El objeto de matriz tiene un elemento cero definido, si es así, actúa sobre el inicio del punto de referencia. <aside class="bcls-aside bcls-aside--information">Nota: Usted tendrá <code translate="No">oncuechange</code> eventos enviados cuando el punto de referencia comienza y se detiene. La <code translate="No">activecues</code> array tendrá un valor solo durante la duración del punto de referencia. Por tanto, si un <code translate="No">oncuechange</code> ocurre el evento y no hay objetos definidos en el <code translate="No">activecues</code> matriz, sabe que el evento enviado es para una parada de punto de referencia.</aside>
      </li>
      <li>En el <code translate="No">oncuechange</code> controlador de eventos, compruebe si el <code translate="No">activecues</code> El objeto de matriz tiene un elemento cero definido, si no, actúa sobre la parada del punto de referencia.</li>
    </ol>
    <aside class="bcls-aside bcls-aside--information">Nota: Si sus puntos de referencia tienen duraciones superpuestas, la lógica de los pasos anteriores deberá modificarse ligeramente.</aside>
    <div class="video-cloud-only">
      <h3>Código de puntos de referencia del proceso</h3>
      <p>&nbsp;</p>
      <ul>
        <li>Línea 122: Cree una pista de texto leyendo en el archivo WebVTT utilizando la <code translate="No">&lt;track&gt;</code> etiqueta.</li>
        <li>Línea 126: Cree un elemento de párrafo como ubicación en la que inyectar HTML creado dinámicamente.</li>
        <li>Líneas 134,152: Utilice el <code translate="No">one()</code> método para escuchar el <code translate="No">loadedmetadata</code> evento solo una vez. La función de controlador de eventos se define aquí de forma anónima.</li>
        <li>Línea 135: Asigne a una variable el índice de la última pista de texto cargada.</li>
        <li>Línea 136: Recupere la matriz TextTracks utilizando el <code translate="No">textTracks()</code> método y asigne el último elemento de la matriz a una variable utilizando el índice determinado en el paso anterior. Ver el <a href="#findtrack">Encuentra la pista correcta</a> sección a continuación para conocer las variaciones de esta lógica.</li>
        <li>Líneas 137,149: Establece la función de controlador de eventos para cuando se distribuye el <code translate="No">oncuechange</code>evento.</li>
        <li>Línea 138: Asegúrese de que el primer punto de referencia (elemento de matriz cero) esté definido en la matriz ActiveCues. Esto indica que se trata de un evento de punto de referencia de inicio.</li>
        <li>Líneas 139-145: Cree HTML de forma dinámica utilizando información del punto de referencia e injételas en la página HTML. Esto incluye analizar JSON y mostrar varios campos de ese JSON.</li>
        <li>Líneas 146-147: Muestra una nota de que se ha alcanzado el extremo del punto de referencia.</li>
        <li>Línea 150: Reproduce el vídeo.</li>
      </ul>
      <pre class="line-numbers" data-start="115">
<code class="language-html" translate="No">&lt;video-js id="myPlayerID2"
  data-account="1752604059001"
  data-player="8cfb6785-c4be-43b4-af68-7ca2fe3a6ebf"
  data-embed="default"
  data-video-id="3851380732001"
  class="video-js" controls&gt;

  &lt;track kind="metadata" src="https://solutions.brightcove.com/bcls/tests/player/cuepoints.vtt" /&gt;
&lt;/video-js&gt;

&lt;p id="insertionPoint2"&gt;&lt;/p&gt;

&lt;script src="https://players.brightcove.net/1752604059001/8cfb6785-c4be-43b4-af68-7ca2fe3a6ebf_default/index.min.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript"&gt;
  videojs.getPlayer('myPlayerID').ready(function() {
    var myPlayer = this;
    myPlayer.one("loadedmetadata", function () {
      var trackIndex = myPlayer.textTracks().length - 1;
      var tt = myPlayer.textTracks()[trackIndex];
      tt.oncuechange = function () {
        if (tt.activeCues[0] !== undefined) {
          var dynamicHTML = "id: " + tt.activeCues[0].id + ", ";
          dynamicHTML += "text: " + tt.activeCues[0].text + ", ";
          dynamicHTML += "startTime: " + tt.activeCues[0].startTime + ",  ";
          dynamicHTML += "endTime: " + tt.activeCues[0].endTime;
          document.getElementById("insertionPoint2").innerHTML += dynamicHTML + "&lt;br/&gt;&lt;br/&gt;";
          jsonData = JSON.parse(tt.activeCues[0].text);
          document.getElementById("insertionPoint2").innerHTML += jsonData.title + ": " + jsonData.description + "&lt;br/&gt;&lt;br/&gt;";
        } else {
          document.getElementById("insertionPoint2").innerHTML += "Cue point duration over" + "&lt;br/&gt;&lt;br/&gt;";
        }
      } //end oncuechange
      myPlayer.play();
      myPlayer.muted(true);
    }); //end loadedmetadata
  }); //end ready
&lt;/script&gt;</code></pre>
    </div>
    <div class="player-only">
      <h3>Código de puntos de referencia del proceso</h3>
      <p>&nbsp;</p>
      <ul>
        <li>Línea 270: Cree una pista de texto leyendo en el archivo WebVTT utilizando la <code translate="No">&lt;track&gt;</code> etiqueta.</li>
        <li>Línea 273: Cree un elemento de párrafo como ubicación en la que inyectar HTML creado dinámicamente.</li>
        <li>Líneas 285,309: Utilice el <code translate="No">one()</code> método para escuchar el <code translate="No">loadedmetadata</code> evento solo una vez. La función de controlador de eventos se define aquí de forma anónima.</li>
        <li>Línea 286: Asigne a una variable el índice de la última pista de texto cargada.</li>
        <li>Línea 287: Recupere la matriz TextTracks utilizando el <code translate="No">textTracks()</code> método y asigne el último elemento de la matriz a una variable utilizando el índice determinado en el paso anterior. Ver el <a href="#findtrack">Encuentra la pista correcta</a> sección a continuación para conocer las variaciones de esta lógica.</li>
        <li>Líneas 289,301: Establece la función de controlador de eventos para cuando se distribuye el <code translate="No">oncuechange</code>evento.</li>
        <li>Línea 290: Asegúrese de que el primer punto de referencia (elemento de matriz cero) esté definido en la matriz ActiveCues. Esto indica que se trata de un evento de punto de referencia de inicio.</li>
        <li>Líneas 291-294: Cree HTML de forma dinámica utilizando información del punto de referencia e injételas en la página HTML. Esto incluye analizar JSON y mostrar varios campos de ese JSON.</li>
        <li>Líneas 295-297: Muestra una nota de que se ha alcanzado el extremo del punto de referencia.</li>
        <li>Línea 302: Reproduce el vídeo.</li>
      </ul>
      <p>&nbsp;</p>
    </div>
    <p>Se podría suponer que podría agregar el archivo WebVTT mediante programación utilizando el <code translate="No">addRemoteTextTrack()</code> método. En este caso, no sería confiable ya que puede experimentar una condición de carrera en la que los puntos de referencia no estarían listos para procesarse antes de intentar usarlos. Es seguro agregar el archivo WebVTT usando el <code translate="No">&lt;track&gt;</code> etiqueta como se muestra.</p>
  </section>
  <section class="bcls-section">
    <h2 id="findtrack">Encuentra la pista correcta</h2>
    <p>En varios lugares de este documento, podría ocurrir un posible problema si se asocian varias pistas de texto con un reproductor. Se asumió que solo una pista de texto está asociada con el reproductor, por lo que se usó este código: <code translate="No">var tt = myPlayer.textTracks()[0];</code>. La selección del elemento de matriz cero supone una única pista de texto asociada al reproductor.</p>
    <p>Las pistas de texto no solo se utilizan para puntos de referencia, sino también para otros tipos de datos. La <strong>amable</strong> El atributo puede contener los siguientes valores:</p>
    <ul>
      <li>subtítulos</li>
      <li>subtítulos</li>
      <li>descripciones</li>
      <li>capítulos</li>
      <li>metadatos</li>
    </ul>
    <p>Esto significa que es muy posible que se puedan asociar varias pistas de texto con el reproductor, y se necesita una forma de encontrar la correcta para la lógica de su aplicación. El siguiente código recorre las pistas de texto disponibles hasta que el <strong>metadatos</strong> (punto de referencia) se encuentra el valor:</p>
    <pre class="line-numbers">
<code class="language-html" translate="No">&lt;script type="text/javascript"&gt;
  videojs.getPlayer('myPlayerID').ready(function() {
    var myPlayer = this,
      allTextTacks,
      attLength,
      tt;
    myPlayer.one("loadedmetadata", function () {
      allTextTacks = myPlayer.textTracks();
      attLength = allTextTacks.length;
      for (var i = 0; i &lt; attLength; i++) {
        if (allTextTacks[i].kind === 'metadata') {
          tt = allTextTacks[i];
          break;
        };
      };
    });
  });
&lt;/script&gt;</code></pre>
    <p>La lógica de los ejemplos anteriores podría usarse para procesar los puntos de referencia usando el <code translate="No">tt</code> variable, que contiene la pista de texto deseada.</p>
  </section>
  <section class="bcls-section video-cloud-only">
    <h2 id="Programmatic_cue_points">Puntos de referencia programáticos</h2>
    <p>Es posible agregar puntos de referencia mediante programación. El método clave proviene del HTML5 <code translate="No">VTTCue</code> interfaz. Puede crear puntos de referencia utilizando la siguiente sintaxis:</p>
    <pre>
<code class="language-javascript" translate="No">new VTTCue( startTime, endTime, text )</code></pre>
    <p>La lógica de procesamiento de los puntos de referencia es muy similar a los ejemplos anteriores, por lo que solo se detallará el código diferente al utilizado anteriormente.</p>
    <ul>
      <li>
        <p>Líneas 43,44: Agrega un <code translate="No">textTrack</code> elemento al jugador que usa el <code translate="No">addRemoteTextTrack()</code> método. Especifica el <code translate="No">kind</code> ser - estar <strong>metadatos</strong> y un <code translate="No">label</code> , en este caso <strong>Punto de señal cronometrado</strong>.</p>
        <aside class="bcls-aside bcls-aside--information">Nota: Debido a que solo las pistas de texto remotas se pueden eliminar de un reproductor, recomendamos usar el <a href="https://docs.brightcove.com/brightcove-player/current-release/Player.html#addRemoteTextTrack">addRemoteTextTrack ()</a> método.</aside>
      </li>
      <li>
        <p>Líneas 45-48: Espere 10 milisegundos antes de crear dos puntos de referencia con el <code translate="No">addCue()</code> método. Los puntos de referencia se instancian utilizando HTML5 <code translate="No">VTTCue()</code> constructor.</p>
        <aside class="bcls-aside bcls-aside--tip">Para Safari e iOS, debe demorarse antes de agregar puntos de referencia o no se agregarán. Esto se debe a que Brightcove Player utiliza pistas asíncronas nativas en el navegador Safari y en iOS.</aside>
      </li>
      <li>Línea 22: Escucha el <code translate="No">addtrack</code> evento.</li>
      <li>Línea 23: Recupera todas las pistas de texto asociadas con el reproductor.</li>
      <li>Línea 24: Establece el <code translate="No">attLength</code> variable al número de pistas de texto. Este valor se utilizará en un bucle en el siguiente segmento de código.</li>
      <li>Líneas 25-30: Recorra cada pista de texto comprobando el <code translate="No">label</code> para ser igual al valor correcto. Cuando lo encuentre, asigne la pista de texto actual a una variable y salga del bucle.</li>
    </ul>
    <aside class="bcls-aside bcls-aside--tip">Nota: Fuera del código de muestra de aprendizaje que sigue, es muy probable que los puntos de referencia se creen en bucle sobre alguna estructura de datos que contenga información de puntos de referencia clave.</aside>
    <pre class="line-numbers" data-start="1">
<code class="language-html" translate="No">&lt;video-js id="myPlayerID"
  data-video-id="4607746980001"
  data-account="1507807800001"
  data-player="default"
  data-embed="default"
  class="video-js"
  width="640" height="360"
  controls&gt;&lt;/video-js&gt;

&lt;script src="https://players.brightcove.net/1507807800001/default_default/index.min.js"&gt;&lt;/script&gt;

&lt;p id="insertionPoint"&gt;&lt;/p&gt;

&lt;script type="text/javascript"&gt;
  videojs.getPlayer("myPlayerID").ready(function () {
    var myPlayer = this,
      textTrack = [],
      allTextTacks,
      attLength,
      tt;
    myPlayer.one("loadedmetadata", function () {
      myPlayer.textTracks().addEventListener('addtrack', function () {
        allTextTacks = myPlayer.textTracks();
        attLength = allTextTacks.length;
        for (var i = 0; i &lt; attLength; i++) {
          if (allTextTacks[i].label === 'Timed Cue Point') {
            tt = allTextTacks[i];
            break;
          }
        }
        tt.oncuechange = function () {
          if (tt.activeCues[0] !== undefined) {
            var dynamicHTML = "id: " + tt.activeCues[0].id + ", ";
            dynamicHTML += "text: &lt;strong&gt;" + tt.activeCues[0].text + "&lt;/strong&gt;, ";
            dynamicHTML += "startTime: &lt;strong&gt;" + tt.activeCues[0].startTime + "&lt;/strong&gt;,  ";
            dynamicHTML += "endTime: &lt;strong&gt;" + tt.activeCues[0].endTime + "&lt;/strong&gt;";
            document.getElementById("insertionPoint").innerHTML += dynamicHTML + "&lt;br/&gt;&lt;br/&gt;";
          } else {
            document.getElementById("insertionPoint").innerHTML += "Cue point duration over" + "&lt;br/&gt;&lt;br/&gt;";
          }
        }; //end oncuechange
      }); // end playing
      textTrack = myPlayer.addRemoteTextTrack({kind: 'metadata', label: 'Timed Cue Point', mode: 'hidden'}, false);
      textTrack.track.mode = 'hidden';
      setTimeout(function(){
        textTrack.track.addCue(new window.VTTCue(2, 5, 'cue point 1 text'));
        textTrack.track.addCue(new window.VTTCue(10, 15, 'cue point 2 text'));
      }, 10);
    }); //end on loadedmetadata
  }); //end ready
&lt;/script&gt;</code></pre>
    <p>El código genera una salida como se muestra en la siguiente captura de pantalla. Nota la <strong>identificación</strong> los valores no se proporcionan un valor cuando se utiliza el <code translate="No">VTTCue()</code> método constructor.</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="dynamic cue points" src="/assets/images/general/cue-points-dynamic.png" /></figure>
  </section>
  <section class="bcls-section">
    <h2 id="ID3_and_media_cue_points">Puntos de referencia de medios y ID3</h2>
    <p>Si tiene puntos de referencia ID3 o puntos de referencia de medios asociados con sus medios, puede tratarlos utilizando el <code translate="No">id3CuePointsTrack()</code> y <code translate="No">mediaCuePointsTrack()</code> métodos. Por ejemplo, para escuchar cambios en el punto de referencia, usaría lo siguiente:</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.getPlayer('myPlayerID').ready(function () {
  var myPlayer = this;
  myPlayer.one("canplay", function () {
    <span class="bcls-highlight">myPlayer.id3CuePointsTrack().on('cuechange', function () {
      // process cue point here
    });</span>
  });
});</code></pre>
    <h3>Detalles ID3</h3>
    <p>A continuación, se proporciona más información sobre el uso de puntos de referencia ID3:</p>
    <ul>
      <li>Las etiquetas ID3 se pueden utilizar para insertar metadatos cronometrados en la transmisión.</li>
      <li>Puede tener varios fotogramas ID3 por segmento.</li>
      <li>Brightcove Player analiza los puntos de referencia ID3 y los expone como una pista de texto, utilizando el mencionado <code translate="No">id3CuePointsTrack()</code> método.</li>
      <li>Es una buena práctica esperar a que <code translate="No">canplay</code> evento o existe la posibilidad de que la pista no sea recuperable al intentar acceder a ella.</li>
      <li>Se admiten varios fotogramas por etiqueta.</li>
    </ul>
  </section>
  <section class="bcls-section">
    <h2 id="Known_issues">Problemas conocidos</h2>
    <ul>
      <li>En Safari, los puntos de referencia no se activarán si la hora de finalización es igual a la hora de inicio. Entonces, si la compatibilidad con Safari es un problema, los puntos de referencia necesitan una duración mayor que cero.</li>
    </ul>
  </section>
</article>
<script src="https://players.brightcove.net/1752604059001/VkIrj2aFx_default/index.min.js"></script><script src="https://players.brightcove.net/3676484087001/4f14e962-a11f-441f-8c00-0c89b8edb0a6_default/index.min.js"></script><script>
  videojs.getPlayer ('myPlayerID'). ready (function () {var player = this; player.one ("loadingmetadata", function () {var tt = player.textTracks () [0]; tt.oncuechange = function ( ) {if (tt.activeCues [0]! == indefinido) {var dynamicHTML = "id: <strong> "+ tt.activeCues [0] .id +", "; dynamicHTML + =" texto: <strong> "+ tt.activeCues [0] .text +", "; dynamicHTML + =" startTime: <strong> "+ tt.activeCues [0] .startTime +", "; dynamicHTML + =" endTime: <strong> "+ tt.activeCues [0] .endTime +" "; document.getElementById (" insertionPoint "). innerHTML + = dynamicHTML +"<br/>";}} //player.play (); player.muted (true);});});
  </script><script>
  videojs.getPlayer ('myPlayerID2'). ready (function () {var myPlayer = this; myPlayer.one ("loadingmetadata", function () {var trackIndex = myPlayer.textTracks (). length -1; var tt = myPlayer. textTracks () [trackIndex]; tt.oncuechange = function () {if (tt.activeCues [0]! == undefined) {console.log ('tt.activeCues [0]', tt.activeCues [0]); var dynamicHTML = "id: <strong> "+ tt.activeCues [0] .id +", "; dynamicHTML + =" texto: <strong> "+ tt.activeCues [0] .text +", "; dynamicHTML + =" startTime: <strong> "+ tt.activeCues [0] .startTime +", "; dynamicHTML + =" endTime: <strong> "+ tt.activeCues [0] .endTime +" "; document.getElementById (" insertionPoint2 "). innerHTML + = dynamicHTML +"<br/><br/>"; jsonData = JSON.parse (tt.activeCues [0] .text); document.getElementById (" insertionPoint2 "). innerHTML + = jsonData.title +": "+ jsonData.description +"<br/><br/>";} else {document.getElementById (" insertionPoint2 "). innerHTML + ="<strong>Duración del punto de señal superior a "+"<br/><br/>";}} // finaliza oncuechange //myPlayer.play (); myPlayer.muted (true);}); // finaliza los metadatos cargados}); // finaliza listo
  </script><script>
  var myPlayer3, textTrack; videojs.getPlayer ('myPlayerID3'). listo (función () { var myPlayer3 = this; myPlayer3.src({ "type": "video/mp4", "src": "//solutions.brightcove.com/bcls/assets/videos/Water-In-Motion.mp4" }); textTrack = myPlayer3.addTextTrack ('metadatos', 'Punto de entrada cronometrado'); textTrack.addCue (nueva ventana.VTTCue (2,4, 'texto del punto de referencia 1')); textTrack.addCue (nueva ventana.VTTCue (6,8, 'texto del punto de referencia 2')); textTrack.addCue (nueva ventana.VTTCue (10,11, 'texto del punto de referencia 3')); textTrack.addCue (nueva ventana.VTTCue (15,20, 'texto del punto de referencia 4 - ÚLTIMO CUEPOINT')); var tt = myPlayer3.textTracks () [0]; tt.oncuechange = function () {if (tt.activeCues [0]! == undefined) {// var dynamicHTML = "id:" + tt.activeCues [0] .id + ","; var dynamicHTML = "texto: <strong> "+ tt.activeCues [0] .text +", "; dynamicHTML + =" startTime: <strong> "+ tt.activeCues [0] .startTime +", "; dynamicHTML + =" endTime: <strong> "+ tt.activeCues [0] .endTime +" "; document.getElementById (" insertionPoint3 "). innerHTML + = dynamicHTML +"<br/>";} else {document.getElementById (" insertionPoint3 "). innerHTML + =" Duración del punto de referencia sobre "+"<br/><br/>";}} // finaliza oncuechange}); // finaliza listo
  </script>